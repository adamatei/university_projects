Ÿ*
eC:\Users\ADA\Documents\GitHub\ping-social-media\Backend\FollowService\Controllers\FollowController.cs
	namespace 	
FollowService
 
. 
Controllers #
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
FollowController !
:" #
ControllerBase$ 2
{ 
private 
readonly 
IFollowManager '
service( /
;/ 0
IPublishEndpoint 
_publishEndpoint )
;) *
public 
FollowController 
(  
IPublishEndpoint  0
publishEndpoint1 @
,@ A
IFollowManagerB P
serviceQ X
)X Y
{ 	
_publishEndpoint 
= 
publishEndpoint .
;. /
this 
. 
service 
= 
service "
;" #
} 	
[ 	
HttpGet	 
( 
$str '
)' (
]( )
public 
IEnumerable 
< 
string !
>! "
GetFollowers# /
(/ 0
string0 6
username7 ?
)? @
{ 	
return 
service 
. 
GetFollowersOfUser -
(- .
username. 6
)6 7
;7 8
}   	
[## 	
HttpGet##	 
(## 
$str## &
)##& '
]##' (
public$$ 
IEnumerable$$ 
<$$ 
string$$ !
>$$! "
GetFollowed$$# .
($$. /
string$$/ 5
username$$6 >
)$$> ?
{%% 	
return&& 
service&& 
.&& 
GetFollowedOfUser&& ,
(&&, -
username&&- 5
)&&5 6
;&&6 7
}'' 	
[** 	
HttpGet**	 
(** 
$str** 
)** 
]** 
public++ 
async++ 
Task++ 
<++ 
Follow++  
>++  !
Get++" %
(++% &
int++& )
id++* ,
)++, -
{,, 	
return-- 
await-- 
service--  
.--  !
GetFollowById--! .
(--. /
id--/ 1
)--1 2
;--2 3
}.. 	
[11 	
HttpGet11	 
(11 
$str11 &
)11& '
]11' (
public22 
List22 
<22 
Follow22 
>22 
GetRequests22 '
(22' (
string22( .
username22/ 7
)227 8
{33 	
return44 
service44 
.44 
GetFollowRequest44 +
(44+ ,
username44, 4
)444 5
;445 6
}55 	
[88 	
HttpPost88	 
]88 
public99 
async99 
Task99 
<99 
Follow99  
>99  !
Post99" &
(99& '
[99' (
FromBody99( 0
]990 1
Follow992 8
follow999 ?
)99? @
{:: 	
FollowRequest;; 
follow_request;; (
=;;) *
new;;+ .
FollowRequest;;/ <
{;;= >
Id;;? A
=;;B C
follow;;D J
.;;J K
Id;;K M
,;;M N
Followed;;O W
=;;X Y
follow;;Z `
.;;` a
Followed;;a i
,;;i j
Follower;;k s
=;;t u
follow;;v |
.;;| }
Follower	;;} Ö
,
;;Ö Ü

isAccepted
;;á ë
=
;;í ì
follow
;;î ö
.
;;ö õ

isAccepted
;;õ •
,
;;• ¶
	isPending
;;ß ∞
=
;;± ≤
follow
;;≥ π
.
;;π ∫
	isPending
;;∫ √
}
;;ƒ ≈
;
;;≈ ∆
await<< 
_publishEndpoint<< "
.<<" #
Publish<<# *
<<<* +
FollowRequest<<+ 8
><<8 9
(<<9 :
follow_request<<: H
)<<H I
;<<I J
return== 
await== 
service==  
.==  !
CreateFollow==! -
(==- .
follow==. 4
)==4 5
;==5 6
}>> 	
[AA 	
HttpPutAA	 
]AA 
publicBB 
asyncBB 
TaskBB 
<BB 
FollowBB  
>BB  !
PutBB" %
(BB% &
intBB& )
idBB* ,
,BB, -
[BB. /
FromBodyBB/ 7
]BB7 8
FollowBB9 ?
followBB@ F
)BBF G
{CC 	
returnDD 
awaitDD 
serviceDD  
.DD  !
UpdateFollowDD! -
(DD- .
followDD. 4
)DD4 5
;DD5 6
}EE 	
[HH 	

HttpDeleteHH	 
(HH 
$strHH 
)HH 
]HH 
publicII 
asyncII 
TaskII 
<II 
boolII 
>II 
DeleteII  &
(II& '
intII' *
idII+ -
)II- .
{JJ 	
returnKK 
awaitKK 
serviceKK  
.KK  !
DeleteFollowKK! -
(KK- .
idKK. 0
)KK0 1
;KK1 2
}LL 	
}MM 
}NN ÿ
cC:\Users\ADA\Documents\GitHub\ping-social-media\Backend\FollowService\DataAccess\DatabaseContext.cs
	namespace 	
FollowService
 
. 

DataAccess "
{ 
public 

class 
DatabaseContext  
:  !
	DbContext! *
{ 
public 
virtual 
DbSet 
< 
Follow #
># $
Follows% ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
	protected

 
override

 
void

 
OnConfiguring

  -
(

- .#
DbContextOptionsBuilder

. E
optionsBuilder

F T
)

T U
{ 	
optionsBuilder 
. 
UseSqlServer '
(' (
$str -
+. /
$str 2
+3 4
$str 
+  !
$str 0
)0 1
;1 2
} 	
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
. 
Entity 
<  
Follow  &
>& '
(' (
entity( .
=>/ 1
{ 
entity 
. 
HasKey 
( 
e 
=>  "
e# $
.$ %
Id% '
)' (
;( )
} 
) 
; 
} 	
} 
} å
bC:\Users\ADA\Documents\GitHub\ping-social-media\Backend\FollowService\DataAccess\FakeRepository.cs
	namespace 	
FollowService
 
. 

DataAccess "
{ 
public 

class 
FakeRepository 
{ 
public 
List 
< 
Follow 
> 
Follows #
{$ %
get& )
;) *
set+ .
;. /
}0 1
=2 3
new4 7
List8 <
<< =
Follow= C
>C D
(D E
)E F
{G H
newI L
FollowM S
{T U
IdV X
=Y Z
$num[ \
,\ ]
Followed^ f
=g h
$stri n
,n o
Followerp x
=y z
$str	{ Å
,
Å Ç

isAccepted
É ç
=
é è
true
ê î
,
î ï
	isPending
ñ ü
=
† °
false
¢ ß
}
® ©
,
© ™
new		I L
Follow		M S
{		T U
Id		V X
=		Y Z
$num		[ \
,		\ ]
Followed		^ f
=		g h
$str		i o
,		o p
Follower		q y
=		z {
$str			| Å
,
		Å Ç

isAccepted
		É ç
=
		é è
false
		ê ï
,
		ï ñ
	isPending
		ó †
=
		° ¢
false
		£ ®
}
		© ™
}
		´ ¨
;
		¨ ≠
}

 
} •
bC:\Users\ADA\Documents\GitHub\ping-social-media\Backend\FollowService\Interfaces\IFollowManager.cs
	namespace 	
FollowService
 
. 

Interfaces "
{ 
public 

	interface 
IFollowManager #
{ 
List		 
<		 
string		 
>		 
GetFollowersOfUser		 '
(		' (
string		( .
username		/ 7
)		7 8
;		8 9
Task

 
<

 
Follow

 
>

 
GetFollowById

 "
(

" #
int

# &
id

' )
)

) *
;

* +
List 
< 
string 
> 
GetFollowedOfUser &
(& '
string' -
username. 6
)6 7
;7 8
Task 
< 
Follow 
> 
CreateFollow !
(! "
Follow" (
follow) /
)/ 0
;0 1
Task 
< 
bool 
> 
DeleteFollow 
(  
int  #
id$ &
)& '
;' (
Task 
< 
Follow 
> 
UpdateFollow !
(! "
Follow" (
follow) /
)/ 0
;0 1
List 
< 
Follow 
> 
GetFollowRequest %
(% &
string& ,
username- 5
)5 6
;6 7
} 
} …@
_C:\Users\ADA\Documents\GitHub\ping-social-media\Backend\FollowService\Managers\FollowManager.cs
	namespace 	
FollowService
 
. 
Managers  
{		 
public

 

class

 
FollowManager

 
:

  
IFollowManager

! /
{ 
private 
readonly 
DatabaseContext (
db) +
;+ ,
public 
FollowManager 
( 
DatabaseContext ,
db- /
)/ 0
{ 	
this 
. 
db 
= 
db 
; 
} 	
public 
async 
Task 
< 
Follow  
>  !
CreateFollow" .
(. /
Follow/ 5
follow6 <
)< =
{ 	
foreach 
( 
var 
f 
in 
db  
.  !
Follows! (
.( )
ToList) /
(/ 0
)0 1
)1 2
{ 
if 
( 
f 
. 
Id 
== 
follow "
." #
Id# %
)% &
{ 
return 
null 
;  
} 
} 
await 
db 
. 
Follows 
. 
AddAsync %
(% &
follow& ,
), -
;- .
await 
db 
. 
SaveChangesAsync %
(% &
)& '
;' (
return 
follow 
; 
}   	
public## 
async## 
Task## 
<## 
bool## 
>## 
DeleteFollow##  ,
(##, -
int##- 0
id##1 3
)##3 4
{$$ 	
foreach%% 
(%% 
var%% 
f%% 
in%% 
db%%  
.%%  !
Follows%%! (
.%%( )
ToList%%) /
(%%/ 0
)%%0 1
)%%1 2
{&& 
if'' 
('' 
f'' 
.'' 
Id'' 
=='' 
id'' 
)'' 
{(( 
db)) 
.)) 
Follows)) 
.)) 
Remove)) %
())% &
f))& '
)))' (
;))( )
await** 
db** 
.** 
SaveChangesAsync** -
(**- .
)**. /
;**/ 0
return++ 
true++ 
;++  
},, 
}-- 
return.. 
false.. 
;.. 
}// 	
public22 
async22 
Task22 
<22 
Follow22  
>22  !
GetFollowById22" /
(22/ 0
int220 3
id224 6
)226 7
{33 	
return44 
await44 
db44 
.44 
Follows44 #
.44# $
	FindAsync44$ -
(44- .
id44. 0
)440 1
;441 2
}55 	
public88 
List88 
<88 
string88 
>88 
GetFollowedOfUser88 -
(88- .
string88. 4
username885 =
)88= >
{99 	
List:: 
<:: 
string:: 
>:: 
followed:: !
=::" #
new::$ '
List::( ,
<::, -
string::- 3
>::3 4
(::4 5
)::5 6
;::6 7
foreach;; 
(;; 
var;; 
f;; 
in;; 
db;;  
.;;  !
Follows;;! (
.;;( )
ToList;;) /
(;;/ 0
);;0 1
);;1 2
{<< 
if== 
(== 
f== 
.== 
Follower== 
==== !
username==" *
&&==+ -
f==. /
.==/ 0

isAccepted==0 :
====; =
true==> B
)==B C
{>> 
followed?? 
.?? 
Add??  
(??  !
f??! "
.??" #
Followed??# +
)??+ ,
;??, -
}@@ 
}AA 
returnBB 
followedBB 
;BB 
}CC 	
publicFF 
ListFF 
<FF 
stringFF 
>FF 
GetFollowersOfUserFF .
(FF. /
stringFF/ 5
usernameFF6 >
)FF> ?
{GG 	
ListHH 
<HH 
stringHH 
>HH 
	followersHH "
=HH# $
newHH% (
ListHH) -
<HH- .
stringHH. 4
>HH4 5
(HH5 6
)HH6 7
;HH7 8
foreachII 
(II 
varII 
fII 
inII 
dbII  
.II  !
FollowsII! (
.II( )
ToListII) /
(II/ 0
)II0 1
)II1 2
{JJ 
ifKK 
(KK 
fKK 
.KK 
FollowedKK 
==KK !
usernameKK" *
&&KK+ -
fKK. /
.KK/ 0

isAcceptedKK0 :
==KK; =
trueKK> B
)KKB C
{LL 
	followersMM 
.MM 
AddMM !
(MM! "
fMM" #
.MM# $
FollowerMM$ ,
)MM, -
;MM- .
}NN 
}OO 
returnPP 
	followersPP 
;PP 
}QQ 	
publicTT 
ListTT 
<TT 
FollowTT 
>TT 
GetFollowRequestTT ,
(TT, -
stringTT- 3
usernameTT4 <
)TT< =
{UU 	
ListVV 
<VV 
FollowVV 
>VV 
requestsVV !
=VV" #
newVV$ '
ListVV( ,
<VV, -
FollowVV- 3
>VV3 4
(VV4 5
)VV5 6
;VV6 7
foreachWW 
(WW 
varWW 
fWW 
inWW 
dbWW  
.WW  !
FollowsWW! (
.WW( )
ToListWW) /
(WW/ 0
)WW0 1
)WW1 2
{XX 
ifYY 
(YY 
fYY 
.YY 
FollowedYY 
==YY !
usernameYY" *
&&YY+ -
fYY. /
.YY/ 0
	isPendingYY0 9
==YY: <
trueYY= A
)YYA B
{ZZ 
requests[[ 
.[[ 
Add[[  
([[  !
f[[! "
)[[" #
;[[# $
}\\ 
}]] 
return^^ 
requests^^ 
;^^ 
}__ 	
publicbb 
asyncbb 
Taskbb 
<bb 
Followbb  
>bb  !
UpdateFollowbb" .
(bb. /
Followbb/ 5
followbb6 <
)bb< =
{cc 	
foreachdd 
(dd 
vardd 
fdd 
indd 
dbdd  
.dd  !
Followsdd! (
.dd( )
ToListdd) /
(dd/ 0
)dd0 1
)dd1 2
{ee 
ifff 
(ff 
fff 
.ff 
Idff 
==ff 
followff "
.ff" #
Idff# %
)ff% &
{gg 
fhh 
.hh 
Followedhh 
=hh  
followhh! '
.hh' (
Followedhh( 0
;hh0 1
fii 
.ii 
Followerii 
=ii  
followii! '
.ii' (
Followerii( 0
;ii0 1
fjj 
.jj 

isAcceptedjj  
=jj! "
followjj# )
.jj) *

isAcceptedjj* 4
;jj4 5
fkk 
.kk 
	isPendingkk 
=kk  !
followkk" (
.kk( )
	isPendingkk) 2
;kk2 3
dbll 
.ll 
Updatell 
(ll 
fll 
)ll  
;ll  !
awaitmm 
dbmm 
.mm 
SaveChangesAsyncmm -
(mm- .
)mm. /
;mm/ 0
returnnn 
fnn 
;nn 
}oo 
}pp 
returnqq 
nullqq 
;qq 
}rr 	
}ss 
}tt ˇ
jC:\Users\ADA\Documents\GitHub\ping-social-media\Backend\FollowService\Migrations\20220307101221_initial.cs
	namespace 	
FollowService
 
. 

Migrations "
{ 
public 

partial 
class 
initial  
:! "
	Migration# ,
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
CreateTable		 (
(		( )
name

 
:

 
$str

 
,

  
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Follower 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: I
,I J
nullableK S
:S T
trueU Y
)Y Z
,Z [
Followed 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: I
,I J
nullableK S
:S T
trueU Y
)Y Z
,Z [

isAccepted 
=  
table! &
.& '
Column' -
<- .
bool. 2
>2 3
(3 4
type4 8
:8 9
$str: ?
,? @
nullableA I
:I J
falseK P
)P Q
,Q R
	isPending 
= 
table  %
.% &
Column& ,
<, -
bool- 1
>1 2
(2 3
type3 7
:7 8
$str9 >
,> ?
nullable@ H
:H I
falseJ O
)O P
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 1
,1 2
x3 4
=>5 7
x8 9
.9 :
Id: <
)< =
;= >
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name 
: 
$str 
)  
;  !
} 	
} 
}   â	
VC:\Users\ADA\Documents\GitHub\ping-social-media\Backend\FollowService\Models\Follow.cs
	namespace 	
FollowService
 
. 
Models 
{ 
public 

class 
Follow 
{ 
public 
virtual 
int 
Id 
{ 
get  #
;# $
set% (
;( )
}* +
public 
virtual 
string 
Follower &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
virtual 
string 
Followed &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
virtual 
bool 

isAccepted &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public		 
virtual		 
bool		 
	isPending		 %
{		& '
get		( +
;		+ ,
set		- 0
;		0 1
}		2 3
} 
} ´

PC:\Users\ADA\Documents\GitHub\ping-social-media\Backend\FollowService\Program.cs
	namespace

 	
FollowService


 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ì#
PC:\Users\ADA\Documents\GitHub\ping-social-media\Backend\FollowService\Startup.cs
	namespace 	
FollowService
 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services   
.   
AddCors   
(   
)   
;   
services!! 
.!! 
AddMassTransit!! #
(!!# $
x!!$ %
=>!!& (
{"" 
x## 
.## 
UsingRabbitMq## 
(##  
(##  !
ctx##! $
,##$ %
cfg##& )
)##) *
=>##+ -
{$$ 
var%% 
uri%% 
=%% 
new%% !
Uri%%" %
(%%% &
Configuration%%& 3
[%%3 4
$str%%4 D
]%%D E
)%%E F
;%%F G
cfg++ 
.++ 
Host++ 
(++ 
$str++ @
)++@ A
;++A B
},, 
),, 
;,, 
}-- 
)-- 
;-- 
services.. 
... '
AddMassTransitHostedService.. 0
(..0 1
)..1 2
;..2 3
services// 
.// 
AddDbContext// !
<//! "
DatabaseContext//" 1
>//1 2
(//2 3
)//3 4
;//4 5
services00 
.00 
AddTransient00 !
<00! "
IFollowManager00" 0
,000 1
FollowManager002 ?
>00? @
(00@ A
)00A B
;00B C
services11 
.11 
AddControllers11 #
(11# $
)11$ %
;11% &
services22 
.22 
AddSwaggerGen22 "
(22" #
c22# $
=>22% '
{33 
c44 
.44 

SwaggerDoc44 
(44 
$str44 !
,44! "
new44# &
OpenApiInfo44' 2
{443 4
Title445 :
=44; <
$str44= L
,44L M
Version44N U
=44V W
$str44X \
}44] ^
)44^ _
;44_ `
}55 
)55 
;55 
}66 	
public99 
void99 
	Configure99 
(99 
IApplicationBuilder99 1
app992 5
,995 6
IWebHostEnvironment997 J
env99K N
)99N O
{:: 	
if;; 
(;; 
env;; 
.;; 
IsDevelopment;; !
(;;! "
);;" #
);;# $
{<< 
app== 
.== %
UseDeveloperExceptionPage== -
(==- .
)==. /
;==/ 0
app>> 
.>> 

UseSwagger>> 
(>> 
)>>  
;>>  !
app?? 
.?? 
UseSwaggerUI??  
(??  !
c??! "
=>??# %
c??& '
.??' (
SwaggerEndpoint??( 7
(??7 8
$str??8 R
,??R S
$str??T f
)??f g
)??g h
;??h i
}@@ 
appBB 
.BB 

UseRoutingBB 
(BB 
)BB 
;BB 
appDD 
.DD 
UseAuthorizationDD  
(DD  !
)DD! "
;DD" #
appEE 
.EE 
UseCorsEE 
(EE 
optionsFF 
=>FF 
optionsFF  
.FF  !
WithOriginsFF! ,
(FF, -
$strFF- D
)FFD E
.FFE F
AllowAnyMethodFFF T
(FFT U
)FFU V
.FFV W
AllowAnyHeaderFFW e
(FFe f
)FFf g
)GG
 
;GG 
appHH 
.HH 
UseEndpointsHH 
(HH 
	endpointsHH &
=>HH' )
{II 
	endpointsJJ 
.JJ 
MapControllersJJ (
(JJ( )
)JJ) *
;JJ* +
}KK 
)KK 
;KK 
}LL 	
}MM 
}NN 